language: scala

jdk: oraclejdk8

sudo: required

services:
- docker

before_install:
- git fetch --tags

stages:
- name: test
- name: release
  if: (branch = master AND type = push) OR (tag IS present)

jobs:
  include:
  - stage: test
    name: "Check formatting"
    script: sbt scalafmtCheck scalafmtSbtCheck
  - name: "Test"
  - script: sbt clean coverage +test coverageReport && bash <(curl -s https://codecov.io/bash)
  - stage: release
    name: "Publishing to Sonatype"
    script: sbt clean ci-release

cache:
  directories:
  - $HOME/.m2
  - $HOME/.ivy2/cache
  - $HOME/.sbt
